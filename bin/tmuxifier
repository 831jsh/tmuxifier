#! /usr/bin/env bash
set -e
[ -n "$TMUXIFIER_DEBUG" ] && set -x

if [ -z "${TMUXIFIER}" ]; then
  export TMUXIFIER="${HOME}/.tmuxifier"
else
  export TMUXIFIER="${TMUXIFIER%/}"
fi

# Load tmuxifier environment variables.
source "$TMUXIFIER/env.sh"

export PATH="$TMUXIFIER/libexec:$PATH"

command="$1"
case "$command" in
  "" | "-h" | "--help" )
    echo -e "tmuxifier $(tmuxifier-version)\n$(tmuxifier-help)" >&2
    ;;

  "-v" | "--version" )
    tmuxifier-version
    ;;

  * )
    # Lookup command, attempt to resolve as alias if fails
    ! command_path="$(command -v "tmuxifier-$command")"
    if [ ! -n $? ]; then
      resolved="$(tmuxifier-alias "$command")"
      if [ ! -z "$resolved" ]; then
        ! command_path="$(command -v "tmuxifier-$resolved")"
      fi
    fi

    if [ -z "$command_path" ]; then
      echo "tmuxifier: no such command '$command'" >&2
      exit 1
    fi

    shift 1
    exec "$command_path" "$@"
    ;;
esac
